{% extends "base.html" %}
{% block content %}
<div class="container mt-4">

    <h2 class="mb-3">Confirmation du rapport d'activité</h2>

    <p>
        Vous êtes sur le point de générer le rapport d’activité pour :
        <strong>{{ month }}/{{ year }}</strong>
    </p>

    <hr>

    <!-- ========================= -->
    <!--        TABLEAU DES VALEURS -->
    <!-- ========================= -->

    <h4 class="mt-4 mb-3">Entrées</h4>
    <table class="table table-bordered">
        <tr>
            <th>Abandons</th>
            <td>{{ counts.entries_abandon }}</td>
        </tr>
        <tr>
            <th>Retours après placement</th>
            <td>{{ counts.entries_return }}</td>
        </tr>
        <tr>
            <th>Trouvés</th>
            <td>{{ counts.entries_found }}</td>
        </tr>
        <tr class="table-primary">
            <th>Total des entrées</th>
            <td><strong>{{ counts.entries_total }}</strong></td>
        </tr>
    </table>

    <h4 class="mt-4 mb-3">Sorties</h4>
    <table class="table table-bordered">
        <tr>
            <th>Placés</th>
            <td>{{ counts.exits_placed }}</td>
        </tr>
        <tr>
            <th>Rendus à leur propriétaire</th>
            <td>{{ counts.exits_returned_owner }}</td>
        </tr>
        <tr>
            <th>Décédés</th>
            <td>{{ counts.exits_deceased }}</td>
        </tr>
        <tr>
            <th>Échappés</th>
            <td>{{ counts.exits_escaped }}</td>
        </tr>
        <tr>
            <th>Transférés vers un autre établissement</th>
            <td>{{ counts.exits_transferred }}</td>
        </tr>
        <tr class="table-primary">
            <th>Total des sorties</th>
            <td><strong>{{ counts.exits_total }}</strong></td>
        </tr>
    </table>

    <h4 class="mt-4 mb-3">Nombre d’animaux</h4>

    <table class="table table-bordered">
        <tr class="table-primary">
            <th>Animaux en début de mois</th>
            <td><strong>{{ counts.count_start }}</strong></td>
        </tr>

        <tr>
            <th>Chats</th>
            <td>{{ counts.count_start - (counts.species1_count + counts.species2_count + counts.species3_count) }}</td>
        </tr>

        <!-- ESPÈCES SUPPLÉMENTAIRES -->
        {% for i in [1,2,3] %}
            <tr>
                <th>{{ counts['species' ~ i ~ '_name'] or '—' }}</th>
                <td>{{ counts['species' ~ i ~ '_count'] }}</td>
            </tr>
        {% endfor %}

        <tr class="table-primary">
            <th>Animaux en fin de mois</th>
            <td><strong>{{ counts.count_end }}</strong></td>
        </tr>
    </table>

    <hr>

    <!-- ========================= -->
    <!--   FORMULAIRE DE VALIDATION -->
    <!-- ========================= -->

    <form action="{{ url_for('generate_activity_report') }}" method="POST">

        <input type="hidden" name="year" value="{{ year }}">
        <input type="hidden" name="month" value="{{ month }}">

        <!-- Champs standards -->
        {% for key, val in counts.items() %}
            {% if not key.startswith("species") %}
                <input type="hidden" name="{{ key }}" value="{{ val }}">
            {% endif %}
        {% endfor %}

        <!-- Champs espèces supplémentaires -->
        {% for i in [1,2,3] %}
            <input type="hidden" name="species{{ i }}_name" value="{{ counts['species' ~ i ~ '_name'] }}">
            <input type="hidden" name="species{{ i }}_count" value="{{ counts['species' ~ i ~ '_count'] }}">
        {% endfor %}

        <button class="btn btn-primary btn-lg mt-3">Générer le PDF</button>
        <a href="{{ url_for('documents') }}" class="btn btn-secondary btn-lg mt-3">Annuler</a>

    </form>

</div>
{% endblock %}
