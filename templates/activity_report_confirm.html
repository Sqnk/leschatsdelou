{% extends "base.html" %}
{% block content %}
<div class="container mt-4">

    <h2 class="mb-3">Confirmation du rapport d'activité</h2>

    <p>
        Vous êtes sur le point de générer le rapport d’activité pour :
        <strong>{{ month }}/{{ year }}</strong>
    </p>

    <hr>

    <!-- ========================= -->
    <!--        TABLEAU DES ENTRÉES -->
    <!-- ========================= -->

    <h4 class="mt-4 mb-3">Entrées</h4>
    <table class="table table-bordered">
        <tr>
            <th>Abandons</th>
            <td>{{ counts.entries_abandon }}</td>
        </tr>
        <tr>
            <th>Retours après placement</th>
            <td>{{ counts.entries_return }}</td>
        </tr>
        <tr>
            <th>Trouvés</th>
            <td>{{ counts.entries_found }}</td>
        </tr>
        <tr class="table-primary">
            <th>Total des entrées</th>
            <td><strong>{{ counts.entries_total }}</strong></td>
        </tr>
    </table>

    <!-- ========================= -->
    <!--        TABLEAU DES SORTIES -->
    <!-- ========================= -->

    <h4 class="mt-4 mb-3">Sorties</h4>
    <table class="table table-bordered">
        <tr>
            <th>Placés</th>
            <td>{{ counts.exits_placed }}</td>
        </tr>
        <tr>
            <th>Rendus à leur propriétaire</th>
            <td>{{ counts.exits_returned_owner }}</td>
        </tr>
        <tr>
            <th>Décédés</th>
            <td>{{ counts.exits_deceased }}</td>
        </tr>
        <tr>
            <th>Échappés</th>
            <td>{{ counts.exits_escaped }}</td>
        </tr>
        <tr>
            <th>Transférés vers un autre établissement</th>
            <td>{{ counts.exits_transferred }}</td>
        </tr>
        <tr class="table-primary">
            <th>Total des sorties</th>
            <td><strong>{{ counts.exits_total }}</strong></td>
        </tr>
    </table>

    <!-- ========================= -->
    <!--     TABLEAU ANIMAUX       -->
    <!-- ========================= -->

    {% set extra_total = 0 %}
    {% for n in species_counts %}
        {% set extra_total = extra_total + n %}
    {% endfor %}

    {# Chats = total - autres espèces (début et fin) #}
    {% set chats_start = counts.count_start - extra_total %}
    {% set chats_end = counts.count_end - extra_total %}

    <h4 class="mt-4 mb-3">Nombre d’animaux</h4>

	<table class="table table-bordered">

    <!-- DÉBUT DE MOIS -->
    <tr class="table-primary">
        <th>Animaux en début de mois</th>
        <td><strong>{{ counts.count_start }}</strong></td>
    </tr>

    <tr>
        <th>Chats</th>
        <td>{{ counts.count_start - species_counts|sum }}</td>
    </tr>

    {% for i in range(species_names|length) %}
        {% set name = species_names[i] %}
        {% set count = species_counts[i] %}
        {% if name %}
            <tr>
                <th>{{ name }}</th>
                <td>{{ count }}</td>
            </tr>
        {% endif %}
    {% endfor %}

    <!-- FIN DE MOIS -->
    <tr class="table-primary">
        <th>Animaux en fin de mois</th>
        <td><strong>{{ counts.count_end }}</strong></td>
    </tr>

    <tr>
        <th>Chats</th>
        <td>{{ counts.count_end - species_counts|sum }}</td>
    </tr>

    {% for i in range(species_names|length) %}
        {% set name = species_names[i] %}
        {% set count = species_counts[i] %}
        {% if name %}
            <tr>
                <th>{{ name }}</th>
                <td>{{ count }}</td>
            </tr>
        {% endif %}
    {% endfor %}

	</table>


    <hr>

    <!-- ========================= -->
    <!--   FORMULAIRE DE VALIDATION -->
    <!-- ========================= -->

    <form action="{{ url_for('generate_activity_report') }}" method="POST">

        <input type="hidden" name="year" value="{{ year }}">
        <input type="hidden" name="month" value="{{ month }}">

        {# Champs standard (numériques) #}
        {% for key, val in counts.items() %}
            <input type="hidden" name="{{ key }}" value="{{ val }}">
        {% endfor %}

        {# Champs espèces supplémentaires #}
        {% for i in range(species_names|length) %}
            <input type="hidden" name="species{{ i+1 }}_name" value="{{ species_names[i] }}">
            <input type="hidden" name="species{{ i+1 }}_count" value="{{ species_counts[i] }}">
        {% endfor %}

        <button class="btn btn-primary btn-lg mt-3">Générer le PDF</button>
        <a href="{{ url_for('documents') }}" class="btn btn-secondary btn-lg mt-3">Annuler</a>

    </form>

</div>
{% endblock %}
