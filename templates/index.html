{% extends "base.html" %}
{% block content %}
<h1 class="mb-4">Chats</h1>

<form action="{{ url_for('api_cats') }}" method="post" enctype="multipart/form-data" class="card p-3 mb-4">
  <div class="row g-3 align-items-end">
    <div class="col-md-4">
      <label class="form-label">Nom *</label>
      <input type="text" name="name" class="form-control" required>
    </div>
    <div class="col-md-3">
      <label class="form-label">Date de naissance</label>
      <input type="date" name="birthdate" class="form-control">
    </div>
    <div class="col-md-3">
      <label class="form-label">Statut</label>
      <select name="status" class="form-select">
        <option value="">—</option>
        <option value="normal">Normal</option>
        <option value="adoptable">Adoptable</option>
        <option value="en_soin">En soin</option>
        <option value="quarantaine">Quarantaine</option>
      </select>
    </div>
    <div class="col-md-6">
      <label class="form-label">Photo</label>
      <input type="file" name="photo" accept=".jpg,.jpeg,.png,.gif" class="form-control">
    </div>
    <div class="col-md-2">
      <button class="btn btn-primary w-100" type="submit">Ajouter</button>
    </div>
  </div>
</form>

<div class="card">
  <div class="card-header">Liste des chats</div>
  <div class="table-responsive">
    <table class="table table-striped align-middle mb-0">
      <thead>
        <tr>
          <th>Photo</th>
          <th>Nom</th>
          <th>Âge</th>
          <th>Statut</th>
          <th>Date de naissance</th>
        </tr>
      </thead>
      <tbody id="cats-body"></tbody>
    </table>
  </div>
</div>

<script>
async function loadCats() {
  const res = await fetch('{{ url_for("api_cats") }}');
  const data = await res.json();
  const tbody = document.getElementById('cats-body');
  tbody.innerHTML = '';
  data.forEach(c => {
    const tr = document.createElement('tr');
    const tdPhoto = document.createElement('td');
    if (c.photo) {
      const img = document.createElement('img');
      img.src = '/uploads/' + c.photo;
      img.alt = c.name;
      img.style.height = '48px'; img.style.width = '48px';
      img.style.objectFit = 'cover'; img.className = 'rounded';
      tdPhoto.appendChild(img);
    } else tdPhoto.textContent = '—';

    const tdName = document.createElement('td'); tdName.textContent = c.name;
    const tdAge = document.createElement('td'); tdAge.textContent = c.age_human || '—';
    const tdStatus = document.createElement('td'); tdStatus.textContent = c.status || '—';
    const tdBirth = document.createElement('td');
    tdBirth.textContent = c.birthdate ? new Date(c.birthdate).toLocaleDateString('fr-FR') : '—';

    tr.appendChild(tdPhoto); tr.appendChild(tdName); tr.appendChild(tdAge);
    tr.appendChild(tdStatus); tr.appendChild(tdBirth);
    tbody.appendChild(tr);
  });
}
document.addEventListener('DOMContentLoaded', loadCats);
</script>
{% endblock %}
