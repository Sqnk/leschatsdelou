{% extends "base.html" %}
{% block content %}

<h2 class="mb-4">Rapport d’activité — {{ month }}/{{ year }}</h2>

<!-- FORMULAIRE DE MODIFICATION DES VALEURS -->
<form method="POST" action="{{ url_for('activity_report_confirm') }}">

    <input type="hidden" name="year" value="{{ year }}">
    <input type="hidden" name="month" value="{{ month }}">

    <div class="row">

        <!-- COLONNE ENTRÉES -->
        <div class="col-md-6">
            <div class="card mb-3">
                <div class="card-header fw-bold">Entrées</div>
                <div class="card-body">

                    <!-- ABANDONS -->
                    <h6>
                        Abandons :
                        <input type="number" name="entries_abandon"
                               class="form-control form-control-sm d-inline-block w-auto"
                               value="{{ counts.entries_abandon }}">
                    </h6>
                    <div class="list-group mb-3">
                        {% for c in entries_lists.abandon %}
                            <a href="{{ url_for('cat_detail', cat_id=c.id) }}"
                               class="list-group-item list-group-item-action d-flex align-items-center gap-3">

                                <!-- PHOTO -->
                                <img src="{{ url_for('uploads', filename=c.photo_filename if c.photo_filename else 'default.png') }}"
									class="rounded"
									style="width: 48px; height: 48px; object-fit: cover;">

                                <div style="flex-grow:1;">
                                    <!-- NOM -->
                                    <div class="fw-bold">{{ c.name }}</div>

                                    <!-- BADGES -->
                                    <div class="d-flex flex-wrap gap-2 mt-1">
                                        {% if c.fiv %}
                                            <span class="badge bg-danger">FIV+</span>
                                        {% endif %}

                                        {% if c.needs_vet %}
                                            <span class="badge bg-warning text-dark">Besoin véto</span>
                                        {% endif %}

                                        {% if c.has_exit %}
                                            <span class="badge bg-secondary">SORTIE</span>
                                        {% endif %}

                                        <span class="badge bg-light text-dark border">
                                            {{ c.status }}
                                        </span>
                                    </div>
                                </div>

                            </a>
                        {% endfor %}
                    </div>

                    <!-- RETOURS APRÈS PLACEMENT -->
                    <h6>
                        Retours après placement :
                        <input type="number" name="entries_return"
                               class="form-control form-control-sm d-inline-block w-auto"
                               value="{{ counts.entries_return }}">
                    </h6>
                    <div class="list-group mb-3">
                        {% for c in entries_lists.return %}
                            <a href="{{ url_for('cat_detail', cat_id=c.id) }}"
                               class="list-group-item list-group-item-action d-flex align-items-center gap-3">

                                <img src="{{ url_for('uploads', filename=c.photo_filename if c.photo_filename else 'default.png') }}"
									class="rounded"
									style="width: 48px; height: 48px; object-fit: cover;">

                                <div style="flex-grow:1;">
                                    <div class="fw-bold">{{ c.name }}</div>

                                    <div class="d-flex flex-wrap gap-2 mt-1">
                                        {% if c.fiv %}
                                            <span class="badge bg-danger">FIV+</span>
                                        {% endif %}

                                        {% if c.needs_vet %}
                                            <span class="badge bg-warning text-dark">Besoin véto</span>
                                        {% endif %}

                                        {% if c.has_exit %}
                                            <span class="badge bg-secondary">SORTIE</span>
                                        {% endif %}

                                        <span class="badge bg-light text-dark border">
                                            {{ c.status }}
                                        </span>
                                    </div>
                                </div>

                            </a>
                        {% endfor %}
                    </div>

                    <!-- TROUVÉS -->
                    <h6>
                        Trouvés :
                        <input type="number" name="entries_found"
                               class="form-control form-control-sm d-inline-block w-auto"
                               value="{{ counts.entries_found }}">
                    </h6>
                    <div class="list-group mb-3">
                        {% for c in entries_lists.found %}
                            <a href="{{ url_for('cat_detail', cat_id=c.id) }}"
                               class="list-group-item list-group-item-action d-flex align-items-center gap-3">

                                <img src="{{ url_for('uploads', filename=c.photo_filename if c.photo_filename else 'default.png') }}"
									 class="rounded"
									 style="width: 48px; height: 48px; object-fit: cover;">

                                <div style="flex-grow:1;">
                                    <div class="fw-bold">{{ c.name }}</div>

                                    <div class="d-flex flex-wrap gap-2 mt-1">
                                        {% if c.fiv %}
                                            <span class="badge bg-danger">FIV+</span>
                                        {% endif %}

                                        {% if c.needs_vet %}
                                            <span class="badge bg-warning text-dark">Besoin véto</span>
                                        {% endif %}

                                        {% if c.has_exit %}
                                            <span class="badge bg-secondary">SORTIE</span>
                                        {% endif %}

                                        <span class="badge bg-light text-dark border">
                                            {{ c.status }}
                                        </span>
                                    </div>
                                </div>

                            </a>
                        {% endfor %}
                    </div>

                    <h5>
                        Total :
                        <input type="number" name="entries_total"
                               class="form-control form-control-sm d-inline-block w-auto"
                               value="{{ counts.entries_total }}">
                    </h5>

                    <h6 class="mt-3">
                        Nombre d’animaux en début de mois :
                        <input type="number" name="count_start"
                               class="form-control form-control-sm d-inline-block w-auto"
                               value="{{ counts.count_start }}">
                    </h6>

                </div>
            </div>
        </div>

        <!-- COLONNE SORTIES -->
        <div class="col-md-6">
            <div class="card mb-3">
                <div class="card-header fw-bold">Sorties</div>
                <div class="card-body">

                    <!-- PLACÉS -->
                    <h6>
                        Placés :
                        <input type="number" name="exits_placed"
                               class="form-control form-control-sm d-inline-block w-auto"
                               value="{{ counts.exits_placed }}">
                    </h6>
                    <div class="list-group mb-3">
                        {% for c in exits_lists.placed %}
                            <a href="{{ url_for('cat_detail', cat_id=c.id) }}"
                               class="list-group-item list-group-item-action d-flex align-items-center gap-3">

                                <img src="{{ url_for('uploads', filename=c.photo_filename if c.photo_filename else 'default.png') }}"
									 class="rounded"
									 style="width: 48px; height: 48px; object-fit: cover;">

                                <div style="flex-grow:1;">
                                    <div class="fw-bold">{{ c.name }}</div>

                                    <div class="d-flex flex-wrap gap-2 mt-1">
                                        {% if c.fiv %}
                                            <span class="badge bg-danger">FIV+</span>
                                        {% endif %}

                                        {% if c.needs_vet %}
                                            <span class="badge bg-warning text-dark">Besoin véto</span>
                                        {% endif %}

                                        {% if c.has_exit %}
                                            <span class="badge bg-secondary">SORTIE</span>
                                        {% endif %}

                                        <span class="badge bg-light text-dark border">
                                            {{ c.status }}
                                        </span>
                                    </div>
                                </div>

                            </a>
                        {% endfor %}
                    </div>

                    <!-- RENDUS À LEUR PROPRIÉTAIRE -->
                    <h6>
                        Rendus à leur propriétaire :
                        <input type="number" name="exits_returned_owner"
                               class="form-control form-control-sm d-inline-block w-auto"
                               value="{{ counts.exits_returned_owner }}">
                    </h6>
                    <div class="list-group mb-3">
                        {% for c in exits_lists.returned_owner %}
                            <a href="{{ url_for('cat_detail', cat_id=c.id) }}"
                               class="list-group-item list-group-item-action d-flex align-items-center gap-3">

                                <img src="{{ url_for('uploads', filename=c.photo_filename if c.photo_filename else 'default.png') }}"
									 class="rounded"
									 style="width: 48px; height: 48px; object-fit: cover;">

                                <div style="flex-grow:1;">
                                    <div class="fw-bold">{{ c.name }}</div>

                                    <div class="d-flex flex-wrap gap-2 mt-1">
                                        {% if c.fiv %}
                                            <span class="badge bg-danger">FIV+</span>
                                        {% endif %}

                                        {% if c.needs_vet %}
                                            <span class="badge bg-warning text-dark">Besoin véto</span>
                                        {% endif %}

                                        {% if c.has_exit %}
                                            <span class="badge bg-secondary">SORTIE</span>
                                        {% endif %}

                                        <span class="badge bg-light text-dark border">
                                            {{ c.status }}
                                        </span>
                                    </div>
                                </div>

                            </a>
                        {% endfor %}
                    </div>

                    <!-- DÉCÉDÉS -->
                    <h6>
                        Décédés :
                        <input type="number" name="exits_deceased"
                               class="form-control form-control-sm d-inline-block w-auto"
                               value="{{ counts.exits_deceased }}">
                    </h6>
                    <div class="list-group mb-3">
                        {% for c in exits_lists.deceased %}
                            <a href="{{ url_for('cat_detail', cat_id=c.id) }}"
                               class="list-group-item list-group-item-action d-flex align-items-center gap-3">

                                <img src="{{ url_for('uploads', filename=c.photo_filename if c.photo_filename else 'default.png') }}"
									 class="rounded"
									 style="width: 48px; height: 48px; object-fit: cover;">

                                <div style="flex-grow:1;">
                                    <div class="fw-bold">{{ c.name }}</div>

                                    <div class="d-flex flex-wrap gap-2 mt-1">
                                        {% if c.fiv %}
                                            <span class="badge bg-danger">FIV+</span>
                                        {% endif %}

                                        {% if c.needs_vet %}
                                            <span class="badge bg-warning text-dark">Besoin véto</span>
                                        {% endif %}

                                        {% if c.has_exit %}
                                            <span class="badge bg-secondary">SORTIE</span>
                                        {% endif %}

                                        <span class="badge bg-light text-dark border">
                                            {{ c.status }}
                                        </span>
                                    </div>
                                </div>

                            </a>
                        {% endfor %}
                    </div>

                    <!-- ÉCHAPPÉS -->
                    <h6>
                        Échappés :
                        <input type="number" name="exits_escaped"
                               class="form-control form-control-sm d-inline-block w-auto"
                               value="{{ counts.exits_escaped }}">
                    </h6>
                    <div class="list-group mb-3">
                        {% for c in exits_lists.escaped %}
                            <a href="{{ url_for('cat_detail', cat_id=c.id) }}"
                               class="list-group-item list-group-item-action d-flex align-items-center gap-3">

                                <img src="{{ url_for('uploads', filename=c.photo_filename if c.photo_filename else 'default.png') }}"
									 class="rounded"
									 style="width: 48px; height: 48px; object-fit: cover;">

                                <div style="flex-grow:1;">
                                    <div class="fw-bold">{{ c.name }}</div>

                                    <div class="d-flex flex-wrap gap-2 mt-1">
                                        {% if c.fiv %}
                                            <span class="badge bg-danger">FIV+</span>
                                        {% endif %}

                                        {% if c.needs_vet %}
                                            <span class="badge bg-warning text-dark">Besoin véto</span>
                                        {% endif %}

                                        {% if c.has_exit %}
                                            <span class="badge bg-secondary">SORTIE</span>
                                        {% endif %}

                                        <span class="badge bg-light text-dark border">
                                            {{ c.status }}
                                        </span>
                                    </div>
                                </div>

                            </a>
                        {% endfor %}
                    </div>

                    <!-- TRANSFÉRÉS -->
                    <h6>
                        Transférés :
                        <input type="number" name="exits_transferred"
                               class="form-control form-control-sm d-inline-block w-auto"
                               value="{{ counts.exits_transferred }}">
                    </h6>
                    <div class="list-group mb-3">
                        {% for c in exits_lists.transferred %}
                            <a href="{{ url_for('cat_detail', cat_id=c.id) }}"
                               class="list-group-item list-group-item-action d-flex align-items-center gap-3">

                                <img src="{{ url_for('uploads', filename=c.photo_filename if c.photo_filename else 'default.png') }}"
									 class="rounded"
									 style="width: 48px; height: 48px; object-fit: cover;">

                                <div style="flex-grow:1;">
                                    <div class="fw-bold">{{ c.name }}</div>

                                    <div class="d-flex flex-wrap gap-2 mt-1">
                                        {% if c.fiv %}
                                            <span class="badge bg-danger">FIV+</span>
                                        {% endif %}

                                        {% if c.needs_vet %}
                                            <span class="badge bg-warning text-dark">Besoin véto</span>
                                        {% endif %}

                                        {% if c.has_exit %}
                                            <span class="badge bg-secondary">SORTIE</span>
                                        {% endif %}

                                        <span class="badge bg-light text-dark border">
                                            {{ c.status }}
                                        </span>
                                    </div>
                                </div>

                            </a>
                        {% endfor %}
                    </div>

                    <h5>
                        Total :
                        <input type="number" name="exits_total"
                               class="form-control form-control-sm d-inline-block w-auto"
                               value="{{ counts.exits_total }}">
                    </h5>

                    <h6 class="mt-3">
                        Nombre d’animaux en fin de mois :
                        <input type="number" name="count_end"
                               class="form-control form-control-sm d-inline-block w-auto"
                               value="{{ counts.count_end }}">
                    </h6>

                </div>
            </div>
        </div>

    </div>

    <!-- VALIDATION DES VALEURS -->
    <button class="btn btn-success btn-lg mt-3">✔ Valider les valeurs</button>

</form>

<a href="{{ url_for('documents') }}" class="btn btn-secondary mt-3">Retour</a>

{% endblock %}
