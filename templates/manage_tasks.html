{% extends "base.html" %}
{% block content %}

<h1 class="mb-4">Gestion des types de tâches</h1>
<p class="text-muted mb-4">Configurez ici les tâches prédéfinies attribuables aux chats.</p>

<div class="row g-4">

  <!-- ------ COLONNE GAUCHE : AJOUT ------ -->
  <div class="col-lg-5">
    <div class="card">
      <div class="card-header">Ajouter un type de tâche</div>
      <div class="card-body">
        <form method="post">
          <input type="hidden" name="action" value="create">

          <div class="mb-3">
            <label class="form-label">Nom</label>
            <input type="text" name="name" class="form-control"
                   placeholder="Ex : Contrôle dents" required>
          </div>

          <div class="mb-3">
            <label class="form-label">Description (optionnel)</label>
            <input type="text" name="description" class="form-control"
                   placeholder="Info supplémentaire">
          </div>

          <button class="btn btn-primary">Ajouter</button>
        </form>
      </div>
    </div>
  </div>

  <!-- ------ COLONNE DROITE : LISTE ------ -->
  <div class="col-lg-7">
    <div class="card">
      <div class="card-header">Liste</div>

      {% if task_types %}
      <ul class="list-group list-group-flush">

        {% for t in task_types %}
        <li class="list-group-item">

          <div class="d-flex justify-content-between align-items-center">
            <div>
              <strong>{{ t.name }}</strong><br>
              <small class="text-muted">{{ t.description or "—" }}</small>
              <br>
              {% if t.is_active %}
                <span class="badge bg-success">Actif</span>
              {% else %}
                <span class="badge bg-secondary">Inactif</span>
              {% endif %}
            </div>

            <div>
              <!-- Bouton modifier -->
              <button class="btn btn-sm btn-outline-primary"
                      data-bs-toggle="collapse"
                      data-bs-target="#edit{{ t.id }}">
                Modifier
              </button>

              <!-- Bouton supprimer -->
              <form action="{{ url_for('manage_tasks') }}"
                    method="post"
                    class="d-inline"
                    onsubmit="return confirm('Supprimer {{ t.name }} ?')">
                <input type="hidden" name="action" value="delete">
                <input type="hidden" name="task_type_id" value="{{ t.id }}">
                <button class="btn btn-sm btn-outline-danger">Supprimer</button>
              </form>
            </div>
          </div>

          <!-- Zone édition -->
          <div class="collapse mt-3" id="edit{{ t.id }}">
            <form method="post" class="border rounded p-3 bg-light">
              <input type="hidden" name="action" value="update">
              <input type="hidden" name="task_type_id" value="{{ t.id }}">

              <div class="mb-3">
                <label class="form-label">Nom</label>
                <input type="text" name="name" class="form-control" value="{{ t.name }}" required>
              </div>

              <div class="mb-3">
                <label class="form-label">Description</label>
                <input type="text" name="description" class="form-control" value="{{ t.description }}">
              </div>

              <div class="form-check mb-3">
                <input class="form-check-input" type="checkbox" name="is_active"
                       {% if t.is_active %}checked{% endif %}>
                <label class="form-check-label">Actif</label>
              </div>

              <button class="btn btn-primary">Enregistrer</button>
            </form>
          </div>

        </li>
        {% endfor %}

      </ul>

      {% else %}
        <p class="text-muted p-3">Aucun type de tâche configuré.</p>
      {% endif %}
    </div>
  </div>

</div>

{% endblock %}
